<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>{% block title %}SoulStart Devotion{% endblock %}</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/theme.css') }}">
  <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='img/favicon.ico') }}">

  <!-- Social cards -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="SoulStart â€” Faith to Rise, Grace to Rest">
  <meta property="og:description" content="Daily devotion for Sunrise & Sunset, prayer requests, and study resources.">
  <meta property="og:image" content="{{ url_for('static', filename='img/hero_day.jpg', _external=True) }}">
  <meta property="og:url" content="{{ request.url_root }}">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="SoulStart â€” Faith to Rise, Grace to Rest">
  <meta name="twitter:description" content="Daily devotion for Sunrise & Sunset, prayer requests, and study resources.">
  <meta name="twitter:image" content="{{ url_for('static', filename='img/hero_day.jpg', _external=True) }}">
</head>

<body class="{{ page_bg_class or '' }}"
      style="{{ '--page-bg:url(' ~ page_bg_url ~ ')' if page_bg_url else '' }}">
  {% if page_bg_class == 'bg-video' and page_bg_video %}
  <video class="bg-video" autoplay muted loop playsinline preload="metadata" poster="{{ page_bg_poster or '' }}">
    <source src="{{ page_bg_video }}" type="video/mp4">
  </video>
  {% endif %}

  <header class="header brand" role="banner">
    <div class="brand">
      <img src="{{ url_for('static', filename='img/sscm_logo.jpg') }}" alt="Silent SoulConnect Ministry" class="logo">
      <div>
        <div class="title">Silent SoulConnect Ministry</div>
        <div class="sub">{{ theme or "Faith to Rise, Grace to Rest" }}</div>
      </div>
    </div>

<nav class="topnav">

  <!-- Public -->
  <a href="{{ url_for('home') }}" class="{{ 'active' if active=='home' else '' }}">Home</a>

  <!-- Devotion / Study = link to Today (acts as hub) -->
  <a href="{{ url_for('devotion_study') }}"
   class="{{ 'active' if active=='devotion_study' else '' }}">
  Devotion / Study
</a>

  <a href="{{ url_for('prayer') }}" class="{{ 'active' if active=='prayer' else '' }}">Prayer</a>

  <!-- Donate endpoint in your app is donation -->
  <a href="{{ url_for('donation') }}" class="{{ 'active' if active=='donation' else '' }}">Donate</a>

  <!-- Get Involved: if you don't have this page yet, temporarily point to volunteer -->
  <a href="{{ url_for('volunteer') }}" class="{{ 'active' if active=='volunteer' else '' }}">Get Involved</a>

  <!-- Hidden / Restricted -->
  {% if is_authed %}
    <a href="{{ url_for('admin') }}" class="{{ 'active' if active=='admin' else '' }}">Admin</a>
    <a href="{{ url_for('logout') }}" class="muted">Logout</a>
  {% else %}
    <a href="{{ url_for('login') }}" class="{{ 'active' if active=='login' else '' }}">Admin</a>
  {% endif %}

</nav>


    <a href="{{ url_for('donation') }}" class="fab fab-donate" aria-label="Give">ðŸ’š</a>
  </header>

  <main class="main" role="main">
    {% block content %}{% endblock %}
  </main>

   <!-- TTS button -->
  <button id="ttsToggle" class="btn tts-btn" aria-label="Read page">ðŸ”Š Read Page</button>

  <!-- Minimal JS (no modal, no extra garbage) -->
  <script>
  // Share site
  (function(){
    const btn = document.getElementById('shareSite');
    if(!btn) return;
    btn.addEventListener('click', async () => {
      const url = window.location.origin;
      const data = { title: 'Silent SoulConnect Ministry', text: 'Faith to Rise, Grace to Rest', url };
      if (navigator.share) { try { await navigator.share(data);} catch(e){} }
      else {
        try { await navigator.clipboard.writeText(url); alert('ðŸ”— Link copied!'); }
        catch(e){ alert('Couldnâ€™t copy link.'); }
      }
    });
  })();

  // Draggable donate FAB
  (function(){
    const fab = document.querySelector('.fab-donate');
    if(!fab) return;
    let drag=false, ox=0, oy=0;
    const start=(x,y)=>{ const r=fab.getBoundingClientRect(); drag=true; ox=x-r.left; oy=y-r.top; fab.style.transition='none'; };
    const move=(x,y)=>{ if(!drag) return; const mx=innerWidth-fab.offsetWidth-6, my=innerHeight-fab.offsetHeight-6;
      const nx=Math.max(6, Math.min(x-ox, mx)); const ny=Math.max(6, Math.min(y-oy, my)); fab.style.left=nx+'px'; fab.style.top=ny+'px'; };
    const end=()=>{ drag=false; fab.style.transition=''; };
    fab.addEventListener('mousedown', e=>{ e.preventDefault(); start(e.clientX,e.clientY); });
    addEventListener('mousemove', e=>move(e.clientX,e.clientY));
    addEventListener('mouseup', end);
    fab.addEventListener('touchstart', e=>{ const t=e.touches[0]; start(t.clientX,t.clientY); }, {passive:true});
    fab.addEventListener('touchmove', e=>{ const t=e.touches[0]; move(t.clientX,t.clientY); }, {passive:true});
    fab.addEventListener('touchend', end);
    if(!fab.style.left) fab.style.left='calc(100vw - 72px)';
    if(!fab.style.top)  fab.style.top ='calc(100vh - 120px)';
  })();

  // Basic TTS
  (function(){
    const btn=document.getElementById('ttsToggle');
    if(!('speechSynthesis' in window)){ btn.style.display='none'; return; }
    let speaking=false;
    btn.addEventListener('click', ()=>{
      const synth=window.speechSynthesis;
      if(speaking){ synth.cancel(); speaking=false; btn.textContent='ðŸ”Š Read Page'; return; }
      const el=document.querySelector('main')||document.body;
      const u=new SpeechSynthesisUtterance(el.innerText.replace(/\s+\n/g,'\n').trim());
      u.rate=1.0; u.pitch=1.0;
      synth.speak(u); speaking=true; btn.textContent='â¹ Stop';
      u.onend=()=>{ speaking=false; btn.textContent='ðŸ”Š Read Page'; };
    });
  })();
  </script>

  <div class="footer-social" aria-label="Social links">
  <a class="icon-link" href="{{ SOCIAL_LINKS.whatsapp }}" target="_blank" rel="noopener noreferrer" aria-label="WhatsApp">
    ðŸ’¬
  </a>
  <a class="icon-link" href="{{ SOCIAL_LINKS.facebook }}" target="_blank" rel="noopener noreferrer" aria-label="Facebook">
    ðŸ“˜
  </a>
  <a class="icon-link" href="{{ SOCIAL_LINKS.linkedin }}" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn">
    ðŸ’¼
  </a>
  <button class="btn soft" id="shareSite">ðŸ”— Share site</button>
</div>

  {% block page_scripts %}{% endblock %}
</body>
</html>
