{% extends "base.html" %}
{% block title %}Home â€” SoulStart{% endblock %}
{% block content %}

<!-- Page-scoped CSS (CSP nonce) -->
<style nonce="{{ csp_nonce() }}">
  .hero.dynamic { background-size: cover; background-position: center; background-repeat: no-repeat; }
  .share-row { display:flex; gap:.5rem; flex-wrap:wrap; }
  .hero-image { display:block; max-width:100%; height:auto; border-radius:12px; }
</style>

<section class="hero {% if hero_bg %}dynamic{% endif %} {{ hero_class }}">
  {% if hero_bg %}
    <!-- Use a data attribute; no inline style attributes -->
    <div id="heroBgCarrier" data-bg="{{ url_for('static', filename=hero_bg) }}"></div>
  {% endif %}

  <div class="hero-inner">
    <h1>Come, all who are thirsty</h1>
    <p class="muted">SoulStart â€” daily devotion to stir faith and bring rest.</p>
    {% if hero_title %}<p class="tag">Today: {{ hero_title }}</p>{% endif %}

    <p class="cta">
      <a class="btn" href="{{ url_for('today') }}">ğŸ“… Open Today</a>
      <a class="btn" href="{{ url_for('verses') }}">ğŸ“– Verses</a>
      <a class="btn" href="{{ url_for('study_index') }}">ğŸ“˜ Explore Studies</a>
      <a class="btn" href="{{ join_url }}" target="_blank" rel="noopener">ğŸ’¬ Join WhatsApp</a>
    </p>
  </div>

  {% if not hero_bg %}
  <div class="hero-container">
    <img src="{{ url_for('static', filename='images/morning.jpg') }}"
         alt="Good Morning"
         class="hero-image">
  </div>
  {% endif %}
</section>

<div class="card">
  <h3>Quick Links</h3>
  <p>
    <a class="btn small" href="{{ url_for('today') }}">ğŸ“… Today</a>
    <a class="btn small" href="{{ url_for('study_index') }}">ğŸ“˜ Study Hub</a>
    <a class="btn small" href="{{ url_for('verses') }}">ğŸ“– Verses</a>
    <a class="btn small" href="{{ url_for('prayer') }}">ğŸ™ Prayer</a>
    <a class="btn small" href="{{ url_for('about') }}">âœï¸ About</a>
  </p>
</div>

<div class="share-row">
  <a class="btn soft small" href="https://api.whatsapp.com/send?text={{ request.url_root|trim|urlencode }}">
    ğŸ’¬ Share on WhatsApp
  </a>
  <button class="btn soft small" id="copyLinkBtn">ğŸ”— Copy Link</button>
</div>

<!-- Page-scoped JS (CSP nonce) -->
<script nonce="{{ csp_nonce() }}">
  (function () {
    // set hero background from data attr (no inline style attrs)
    const carrier = document.getElementById('heroBgCarrier');
    if (carrier) {
      const url = carrier.getAttribute('data-bg');
      const hero = carrier.closest('.hero');
      if (url && hero) hero.style.backgroundImage = "url('" + url + "')";
    }

    // copy link button
    const btn = document.getElementById('copyLinkBtn');
    if (btn) {
      btn.addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(window.location.origin + '/');
          alert('Link copied!');
        } catch {
          alert('Unable to copy, please copy manually.');
        }
      });
    }
  })();
</script>

{% endblock %}
